---
title: "Advanced Portfolio Optimization Example"
format: html
editor: visual
---

## Custom Configuration and Input

```{r}
# Setup: copy and edit input/config manually if needed
file.copy("data/sector_factor_timeseries.csv", "data/custom_input.csv", overwrite = TRUE)
file.copy("data/optimizer_config.yaml", "data/custom_config.yaml", overwrite = TRUE)
```

```{r}
# Load pipeline using new input and config
source("R/pipeline_runner.R")
result <- run_pipeline(input_csv = "data/custom_input.csv",
                       config_file = "data/custom_config.yaml",
                       output_file = "output/custom_optimization.parquet")
print(head(result))
```

## Evaluation and Visualization

```{r}
# Evaluate the saved weights
source("R/evaluator.R")
eval_result <- evaluate_saved_model(input_csv = "data/custom_input.csv",
                                    weights_path = "output/weights.parquet")
cat("Alpha:", eval_result$alpha, "\n")
cat("IR:", eval_result$ir, "\n")
```

```{r}
# Visualize predicted vs actual returns
library(ggplot2)
ggplot(eval_result$result, aes(x = actual_return, y = predicted_return)) +
  geom_point(color = "blue") +
  geom_smooth(method = "lm", se = FALSE, color = "black") +
  labs(title = "Custom Optimization: Predicted vs Actual Returns",
       x = "Actual Returns", y = "Predicted Returns")
```